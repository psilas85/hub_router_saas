# ğŸ“¦ HubRouter - Onboarding para Tenants (Clientes)

Bem-vindo ao sistema HubRouter! Este guia rÃ¡pido ajudarÃ¡ vocÃª a estruturar corretamente seus dados, realizar o upload e rodar o sistema para visualizar os clusters de entrega gerados.

---

## âœ… Etapa 1: Estrutura de Pastas por Tenant

Ao cadastrar um novo cliente (tenant), vocÃª deve criar as seguintes pastas:

```
clusterization/
  â””â”€â”€ tenants/
       â””â”€â”€ <tenant_id>/
            â”œâ”€â”€ input/
            â”‚    â””â”€â”€ dados_input.csv   # Arquivo de entrada
            â”œâ”€â”€ output/               # SaÃ­da com registros invÃ¡lidos (se houver)
            â””â”€â”€ maps/                 # Mapas HTML gerados
```

O sistema criarÃ¡ automaticamente essas pastas ao rodar os scripts principais ou o atalho de upload.

---

## ğŸ“ Etapa 2: Estrutura do CSV de Entrada

O arquivo `dados_input.csv` deve estar no diretÃ³rio:
```
tenants/<tenant_id>/input/dados_input.csv
```

### Colunas obrigatÃ³rias (mÃ­nimas para processamento):
| Coluna Original         | Significado                        |
|-------------------------|-------------------------------------|
| Filial                  | Nome da transportadora              |
| Remetente               | Nome do remetente                   |
| CNPJ/CPF                | CNPJ do remetente                   |
| Origem / UF Origem      | Cidade/UF de origem                 |
| DestinatÃ¡rio            | Nome do destinatÃ¡rio                |
| CNPJ/CPF.1              | CNPJ do destinatÃ¡rio                |
| EndereÃ§o entrega        | Rua/Avenida da entrega              |
| Bairro / Cidade / UF Entrega | InformaÃ§Ãµes do destino          |
| CEP                     | CEP da entrega                      |
| NF                      | NÃºmero da nota fiscal               |
| Volumes                 | Quantidade de volumes               |
| Kg Taxado               | Peso total                          |
| Valor NF / Valor Frete  | Valores em reais                    |
| Doc/Min                 | Identificador do CT-e               |
| Data Frete              | Data de envio da carga              |

> O delimitador do arquivo deve ser `;` (ponto e vÃ­rgula) e a codificaÃ§Ã£o deve ser UTF-8.

---

## âš™ï¸ Etapa 3A: Executar o PrÃ©-Processamento Manual

No terminal, rode:
```bash
python main_preprocessing.py
```
VocÃª serÃ¡ solicitado a informar o ID do tenant:
```
Informe o ID do tenant: dev_tenant
```

---

## âš¡ Etapa 3B: (Alternativa) Upload + Processamento com 1 comando

Use o atalho gerado automaticamente ou rode diretamente:
```bash
python upload_csv_cli.py --csv "Caminho/do/seu/arquivo.csv" --tenant dev_tenant
```
Ou utilize o atalho, por exemplo:
```
upload_csv_dev_tenant.bat  (Windows)
upload_csv_dev_tenant.sh   (Linux/macOS)
```
Este comando:
- Cria a estrutura do tenant
- Copia o CSV
- Executa o prÃ©-processamento
- Grava os dados no banco

---

## ğŸ§  Etapa 4: Rodar ClusterizaÃ§Ã£o

No terminal, rode:
```bash
python main_clusterization.py
```
O sistema solicitarÃ¡ a data e o tenant:
```
Informe a data inicial (YYYY-MM-DD): 2025-03-31
Informe a data final (YYYY-MM-DD): 2025-03-31
Informe o ID do tenant: dev_tenant
```

Os clusters serÃ£o salvos no banco e os centros recalculados automaticamente.

---

## ğŸ—ºï¸ Etapa 5: Visualizar Mapas

Execute:
```bash
python main_cluster_plotting.py
```
SerÃ¡ solicitado:
```
Informe a data inicial (YYYY-MM-DD): 2025-03-31
Informe a data final (YYYY-MM-DD): 2025-03-31
Informe o ID do tenant: dev_tenant
```

O mapa serÃ¡ gerado e salvo em:
```
tenants/dev_tenant/maps/cluster_map_2025-03-31.html
```
Abra esse arquivo em qualquer navegador.

---

## ğŸ§¼ Dicas
- Sempre valide os campos obrigatÃ³rios antes de subir o CSV.
- Utilize nomes curtos e sem espaÃ§os para `tenant_id` (ex: `cliente1`, `logistica_x`).
- O log de execuÃ§Ã£o Ã© exibido diretamente no terminal para facilitar testes.
- Se quiser testar tudo com um comando sÃ³, utilize os atalhos `.bat` ou `.sh` gerados automaticamente apÃ³s rodar `gerar_atalhos_upload.py`.

---

Para dÃºvidas ou suporte tÃ©cnico, entre em contato com o time de tecnologia do Cluster Router.

---